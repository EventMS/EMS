version: '3.4'

services:

  seq:
    image: datalust/seq:latest

  sqldata:
    image: mcr.microsoft.com/mssql/server:2017-latest 

  rabbitmq:
    image: rabbitmq:3-management-alpine

  identity-api:
    image: ${REGISTRY:-eshop}/identity.api:${PLATFORM:-linux}-${TAG:-latest}
    build:
      context: .
      dockerfile: Services/Identity/Identity.API/Dockerfile
    depends_on:
      - sqldata
      - rabbitmq

  template1-api:
    image: ${REGISTRY:-eshop}/template1.api:${PLATFORM:-linux}-${TAG:-latest}
    build:
      context: .
      dockerfile: Services/Template1/Template1.API/Dockerfile
    depends_on:
      - sqldata
      - identity-api
      - rabbitmq

  club-api:
    image: ${REGISTRY:-eshop}/club.api:${PLATFORM:-linux}-${TAG:-latest}
    build:
      context: .
      dockerfile: Services/Club/Club.API/Dockerfile
    depends_on:
      - sqldata
      - rabbitmq

  permission-api:
    image: ${REGISTRY:-eshop}/permission.api:${PLATFORM:-linux}-${TAG:-latest}
    build:
      context: .
      dockerfile: Services/Permission/Permission.API/Dockerfile
    depends_on:
      - sqldata
      - identity-api
      - rabbitmq


  graphql-api:
    image: ${REGISTRY:-eshop}/graphql.api:${PLATFORM:-linux}-${TAG:-latest}
    build:
      context: .
      dockerfile: ApiGateways/GraphQL/GraphQL.API/Dockerfile
    depends_on:
      - template1-api
      - identity-api

  webstatus:
    image: ${REGISTRY:-eshop}/webstatus:${PLATFORM:-linux}-${TAG:-latest}
    build:
      context: .
      dockerfile: Web/WebStatus/Dockerfile